#!/bin/bash

if [ "$1" = "?" ]
	then
		B1="\033[1m";
		B2="\033[0m";
		echo -e "";
		echo -e "${B1}AUTHOR${B2}";
		echo -e "  Nicholas Almeida";
		echo -e "";
		echo -e "${B1}INFO${B2} (release 2011-05-18)";
		echo -e "  simple shortcut to create a new website on Mac / Apache";
		echo -e "  based on step-by-steb \"benjaminpearson\" Snippler http://snipplr.com/view/24334";
		echo -e "";
		echo -e "${B1}BEFORE START${B2}";
		echo -e "  1) before start (just the first time) open the file: /etc/apache2/httpd.conf"
		echo -e "  2) find \"Virtual Hosts\""
		echo -e "  3) add and uncomment the two lines below respectively"
		echo -e "     # Virtual hosts"
		echo -e "     NameVirtualHost *:80"
		echo -e "     Include /private/etc/apache2/extra/httpd-vhosts.conf"
		echo -e "";
		echo -e "${B1}IMPORTANT${B2}";
		echo -e "  1) ALWAYS USE ABSOLUTE PATH TO YOUR DIRECTORY"
		echo -e "  2) always run \"create-local-website\" using sudo"
		echo -e "     sudo create-local-website ..."
		echo -e "  3) you must pick a uniquename for your website"
		echo -e "  4) ensure you are ${B1}NOT${B2} trailing \"/\" in the directory path"
		echo -e "";
		echo -e "${B1}COMMOM ISSUES${B2}";
		echo -e "   1) if you are facing \"Directory Listing Denied\" or \"Forbidden\" 403 error";
		echo -e "      a) check if you've used the ABSOLUTE PATH to your website directory";
		echo -e "      b) try set the \"chmod 777\" on your parent(s) folder";
		echo -e "         sudo chmod -Rf 777 /absolute/path/to/uniquename/";
		echo -e "";
		echo -e "${B1}USAGE${B2}";
		echo -e "   create-local-website /absolute/path/to/uniquename/website/files uniquename";
		echo -e "   -- ALWAYS USE ABSOLUTE PATH TO YOUR DIRECTORY --";
		echo -e "";
		echo -e "${B1}EXAMPLES${B2}";
		echo -e "   sudo create-local-website /Users/nalmeida/test-website test-website.dev";	
		echo -e "";
		exit 1;
fi

if [ "$1" = "" ];
	then 
		echo "[ERROR] you must set the absolute path and uniquename of your website";
		echo "        for help run $ create-local-website ?";
	exit 1;
fi

if [ "$2" = "" ];
	then 
		echo "[ERROR] you must set a uniquename for your website";
		echo "        for help run $ create-local-website ?";
	exit 1;
fi

# If you have your own httpd-vhosts.conf file in another folder, just change the variable bellow
VHOSTS="/private/etc/apache2/extra/httpd-vhosts.conf";

echo "
[echo] adding site information into \"$VHOSTS\" file"
echo "
<Directory \"$1/\">
	Options Indexes MultiViews FollowSymLinks
	AllowOverride All
	Order allow,deny
	Allow from all
</Directory> 
<VirtualHost *:80>
	ServerName \"$2\"
	DocumentRoot \"$1\"
	ServerAdmin webmaster@$2
	ErrorLog \"/private/var/log/apache2/$2-error_log\"
	CustomLog \"/private/var/log/apache2/$2-access_log\" common
</VirtualHost>" >> $VHOSTS

echo "[echo] adding site information into \"/etc/hosts\" file"
echo "
127.0.0.1 $2" >> /etc/hosts

echo "[echo] setting chmod 777 permissions on directory $1 (sudo chmod -Rf 777 $1/)"
sudo chmod -Rf 777 $1/

echo "[echo] restarting Apache (sudo apachectl restart)"
sudo apachectl restart

echo "[echo] flushing Apache entire cache (sudo dscacheutil -flushcache)"
sudo dscacheutil -flushcache

echo "[echo] website created: http://$2/
"